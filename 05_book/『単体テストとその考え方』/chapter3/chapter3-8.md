# なぜ統合テストを行うのか？

## 統合テストとは？

### 単体テスト以外のテスト
- 単体テストの性質
  - 1単位のふるまいを検証すること
  - 実行時間が短いこと
  - 他のテストケースから隔離されて実行されること

## 統合テストの目的
統合テストとは、プロセス外依存との観察可能な振る舞いをテストすることが目的である
外部システムの視点でテストするようなもの

![統合テストの構造](resource/統合テスト構造.png)

## テストピラミッド

### 単体テストの役割
検証する内容のほとんどは単体テストに持たせる
- 可能な限りの異常ケースを検証する

### 統合テストの役割
- 1, 2件の包括的なhappy path
- 単体テストでは実施できない異常ケース

![テストピラミッド](resource/test_pyramid.png)

## プロセス外依存のmock化について

### 2種類のプロセス外依存
- 管理下にあるプロセス外依存
  - (e.g.) テスト対象システムでのみ使用されるデータベース
- 管理下にないプロセス外依存
  - (e.g.) 外部システム、メールサービス

### 管理下にあるプロセス外依存
*モックに置き換えるべき依存*

この依存は後方互換を維持する必要があり、テスト対象システムのリファクタリングによって外部システムとの仕様が壊れていないか確認できる

### 管理下にあるプロセス外依存
*モックに置き換えるべきではない依存*

この依存は外部システムにとって実装の詳細であるため、実際の依存をそのまま使用するほうが実際の結果に近くなりテストの品質が上がる。

> [!WARNING] 質の悪いテストケースを作成するなら、作成しないほうが良い。
管理下にあるプロセス外依存をそのまま使用することができない場合、その統合テストに価値は無いため作成せず単体テストにとどめる方が良いことになる。

